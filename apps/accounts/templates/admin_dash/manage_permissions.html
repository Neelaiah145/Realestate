{% extends "admin_base.html" %}

{% block content %}

<h2>Permission Management</h2>

<!-- AGENT SELECT -->
<form method="GET">
    <label><strong>Select Agent:</strong></label>
    <select name="agent" onchange="this.form.submit()">
        <option value="">-- Select Agent --</option>
        {% for agent in agents %}
            <option value="{{ agent.id }}"
                {% if selected_agent and agent.id == selected_agent.id %}
                    selected
                {% endif %}
            >
                {{ agent.username }} ({{ agent.email }})
            </option>
        {% endfor %}
    </select>
</form>

<hr>

{% if selected_agent %}
<h3>
    Managing permissions for:
    <span style="color:green;">
        {{ selected_agent.username }} ({{ selected_agent.email }})
    </span>
</h3>

<form method="POST">
    {% csrf_token %}
    <input type="hidden" name="agent_id" value="{{ selected_agent.id }}">

    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;">
        {% for perm in permissions %}
            <label style="border:1px solid #ddd;padding:10px;border-radius:6px;">
                <input type="checkbox"
                       name="permissions"
                       value="{{ perm.id }}"
                       {% if perm.id in user_permissions %}checked{% endif %}>
                <strong>{{ perm.name }}</strong><br>
                <small>{{ perm.codename }}</small>
            </label>
        {% endfor %}
    </div>

    <button type="submit" style="margin-top:20px;">
        Save Permissions
    </button>
</form>

{% else %}
<p><em>Select an agent to manage permissions.</em></p>
{% endif %}

{% endblock %}

