{% extends "agent_base.html" %}

{% block title %}Agent Leads | Realestate{% endblock %}

{% block content %}

{# üîî FOLLOW-UP ALERT #}
{% if followups %}
<div style="
    background:#fff7ed;
    color:#9a3412;
    padding:12px 16px;
    border-radius:10px;
    margin-bottom:20px;
    font-size:15px;
">
    üîî You have <strong>{{ followups.count }}</strong> follow-ups due!
</div>
{% endif %}

<h2>My Leads</h2>

<table border="1" cellpadding="10" cellspacing="0" width="100%">
    <thead>
        <tr>
            <th>Sl.No</th>
            <th>Name</th>
            <th>Status</th>
            <th>Assigned At</th>
            <th>Updated At</th>
            <th>Action</th>
        </tr>
    </thead>

    <tbody>
        {% for lead in leads %}
        <tr>
            {# üî¢ GLOBAL SERIAL NUMBER (WORKS WITH PAGINATION) #}
            <td>{{ leads.start_index|add:forloop.counter0 }}</td>

            <td>{{ lead.name }}</td>
            <td>{{ lead.get_status_display }}</td>
            <td>{{ lead.assigned_at|date:"d M Y H:i" }}</td>
            <td>{{ lead.updated_at|date:"d M Y H:i" }}</td>

            <td>
                <!-- üëÅ VIEW DETAILS -->
                <a href="{% url 'lead_detail' lead.id %}"
                   title="View Details"
                   style="color:#2563eb; text-decoration:none;">
                    üëÅ
                </a>
                |

                <!-- ‚úèÔ∏è UPDATE -->
                <a href="{% url 'update_lead_status' lead.id %}"
                   style="color:green; text-decoration:none;">
                    Update
                </a>
                |

                <!-- üóë DELETE -->
                <form method="post"
                      action="{% url 'delete_lead' lead.id %}"
                      style="display:inline;"
                      onsubmit="return confirm('Delete this lead?');">
                    {% csrf_token %}
                    <button type="submit"
                            style="color:red; background:none; border:none; cursor:pointer;">
                        Delete
                    </button>
                </form>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" style="text-align:center;">
                No leads available
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{# üìÑ PAGINATION FOOTER #}
{% if leads.has_other_pages %}
<div style="
    margin-top:20px;
    display:flex;
    justify-content:flex-start;
    align-items:center;
    gap:6px;
    font-size:14px;
">

    {# ‚Üê PREVIOUS #}
    {% if leads.has_previous %}
        <a href="?page={{ leads.previous_page_number }}"
           style="padding:6px 10px;border:1px solid #d1d5db;border-radius:6px;text-decoration:none;">
            ‚Üê Prev
        </a>
    {% else %}
        <span style="padding:6px 10px;color:#9ca3af;border:1px solid #e5e7eb;border-radius:6px;">
            ‚Üê Prev
        </span>
    {% endif %}

    {# PAGE NUMBERS #}
    {% for num in leads.paginator.page_range %}
        {% if leads.number == num %}
            <span style="
                padding:6px 10px;
                background:#4f46e5;
                color:#ffffff;
                border-radius:6px;
                font-weight:500;
            ">
                {{ num }}
            </span>
        {% else %}
            <a href="?page={{ num }}"
               style="padding:6px 10px;border:1px solid #d1d5db;border-radius:6px;text-decoration:none;">
                {{ num }}
            </a>
        {% endif %}
    {% endfor %}

    {# NEXT ‚Üí #}
    {% if leads.has_next %}
        <a href="?page={{ leads.next_page_number }}"
           style="padding:6px 10px;border:1px solid #d1d5db;border-radius:6px;text-decoration:none;">
            Next ‚Üí
        </a>
    {% else %}
        <span style="padding:6px 10px;color:#9ca3af;border:1px solid #e5e7eb;border-radius:6px;">
            Next ‚Üí
        </span>
    {% endif %}

</div>
{% endif %}

{% endblock %}
