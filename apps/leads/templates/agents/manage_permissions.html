{% extends "admin_base.html" %}
{% load static %}

{% block content %}

<style>
/* ===== Permissions Page Styling ===== */

.perm-title {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 20px;
    color: #333;
}

.perm-container {
    background: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    max-width: 900px;
}

.perm-agent-form {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
}

.perm-label {
    font-weight: 500;
    color: #444;
}

.perm-agent-select {
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
    cursor: pointer;
}

hr {
    margin: 20px 0;
    border: none;
    border-top: 1px solid #eee;
}

h3 {
    margin-bottom: 15px;
    color: #222;
}

/* Permissions Grid */
.perm-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 12px;
    margin-bottom: 20px;
}

.perm-item {
    background: #f8f9fa;
    padding: 10px 12px;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: background 0.2s ease;
}

.perm-item:hover {
    background: #eef3ff;
}

.perm-item input {
    accent-color: #4f46e5;
}

/* Save Button */
.perm-save-btn {
    background: #4f46e5;
    color: #fff;
    border: none;
    padding: 10px 22px;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    transition: background 0.2s ease;
}

.perm-save-btn:hover {
    background: #4338ca;
}

.perm-empty {
    color: #777;
    font-style: italic;
}
</style>

<h2 class="perm-title">{{ page_title }}</h2>

<div class="perm-container">

    <form method="GET" class="perm-agent-form">
        <label class="perm-label">Select Agent</label>
        <select name="agent" onchange="this.form.submit()" class="perm-agent-select">
            <option value="">Select Agent --</option>
            {% for agent in agents %}
            <option value="{{ agent.id }}">{{ agent.username }}</option>
            {% endfor %}
        </select>
    </form>

    <hr>

    {% if selected_agent %}
    <h3>Permissions for {{ selected_agent.username }}</h3>

    <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="agent_id" value="{{ selected_agent.id }}">

        <div class="perm-grid">
            {% for perm in permissions %}
            <label class="perm-item">
                <input type="checkbox"
                       name="permissions"
                       value="{{ perm.id }}"
                       {% if perm.id in user_permissions %}checked{% endif %}>
                {{ perm.name }}
            </label>
            {% endfor %}
        </div>

        <button class="perm-save-btn">Save Permissions</button>
    </form>
    {% else %}
    <p class="perm-empty">Select an agent to manage permissions.</p>
    {% endif %}

</div>

{% endblock %}
