{% extends "admin_base.html" %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'leads/style.css' %}">

<div class="admin-container">

    <!-- PAGE TITLE -->
    <div class="admin-header">
        <h2 class="admin-title">Admin Lead Dashboard</h2>
    </div>

    <!-- STATS -->
    <div class="stats">
        <div class="card">
            <span>Total Leads</span>
            <strong>{{ stats.total }}</strong>
        </div>
        <div class="card">
            <span>Open Leads</span>
            <strong>{{ stats.open }}</strong>
        </div>
        <div class="card">
            <span>Closed Leads</span>
            <strong>{{ stats.closed }}</strong>
        </div>
    </div>

    <!-- FILTERS -->
    <form method="get" class="filters">
        <div class="filter-group">
            <select name="date">
                <option value="">All Dates</option>
                <option value="today" {% if date_filter == "today" %}selected{% endif %}>Today</option>
                <option value="week" {% if date_filter == "week" %}selected{% endif %}>This Week</option>
    
            </select>

            <select name="agent">
                <option value="">All Agents</option>
                {% for agent in agents %}
                    <option value="{{ agent.id }}"
                        {% if agent_id|add:"0" == agent.id %}selected{% endif %}
                    >
                        {{ agent.username }}
                    </option>
                {% endfor %}
            </select>

            <button type="submit">Apply</button>
        </div>
    </form>

    <!-- TABLE WRAPPER (IMPORTANT FOR MOBILE) -->
    <div class="table-wrapper">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>SL.NO</th>
                    <th>Customer</th>
                    <th>Phone</th>
                    <th>Agent</th>
                    <th>Status</th>
                    <th>Updated</th>
                    <th>Response</th>
                </tr>
            </thead>
            <tbody>
                {% for lead in leads %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ lead.name }}</td>
                    <td>{{ lead.phone }}</td>
                    <td>{{ lead.assigned_agent.username|default:"Unassigned" }}</td>
                    
                    <td>
                        <span class="status {{ lead.status }}">
                            {{ lead.get_status_display }}
                        </span>
                    </td>
                    <td>{{ lead.updated_at|date:"d M Y, h:i A" }}</td>
                    <!-- <td>
                        <a href="{% url 'lead_detail' lead.id %}" class="action-link" title="View">üëÅ</a>
                    </td> -->
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="empty">
                        No leads found for selected filters
                    </td>
                </tr>
               
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<!-- AUTO REFRESH -->
<script>
    setTimeout(() => window.location.reload(), 60000);
</script>

{% endblock %}
