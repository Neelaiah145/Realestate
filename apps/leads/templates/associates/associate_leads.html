{% extends "associate_base.html" %}
{% load static %}

{% block title %}Associate Dashboard{% endblock %}

{% block content %}

<link rel="stylesheet" href="{% static 'leads/style.css' %}">

<h2 class="page-header">
    My Assigned Leads
    <span class="lead-count">- ({{ leads.count }})</span>
</h2>

<table class="leads-table">
    <thead>
        <tr>
            <th>SL.NO</th>
            <th>Name</th>
            <th>Status</th>
            <th>Assigned At</th>
            <th>Updated At</th>
            <th>Action</th>
        </tr>
    </thead>

    <tbody>
        {% for lead in leads %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ lead.name }}</td>
            <td>{{ lead.get_status_display }}</td>
            <td>{{ lead.assigned_at|date:"d M Y - h:i A" }}</td>
            <td>{{ lead.updated_at|date:"d M Y - h:i A" }}</td>
            <td>
                <a href="{% url 'lead_detail' lead.id %}" class="action-link" title="View">üëÅ</a> |

                {% if perms.leads.can_update_lead %}
                <a href="{% url 'update_lead_status' lead.id %}" class="action-link" title="Update">
                    Update
                </a> |
                {% endif %}

                {% if request.user.role == "agent" %}
                <a href="{% url 'move_lead' lead.id %}" class="action-link">
                    Move
                </a> |
                {% endif %}

                {% if perms.leads.can_book_lead %}
                <a href="#" class="action-link booking-link" title="Booking">
                    Booking
                </a> |
                {% endif %}

                {% if perms.leads.can_delete_lead %}
                <form method="post"
                      action="{% url 'delete_lead' lead.id %}"
                      style="display:inline;"
                      onsubmit="return confirm('Delete this lead?');">
                    {% csrf_token %}
                    <button type="submit" class="delete-btn" title="Delete">
                        Delete
                    </button>
                </form>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" style="text-align:center;color:#6b7280;">
                No leads assigned to you
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
