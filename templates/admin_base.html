{% load static %}
<!doctype html>
<html lang="en" class="">
<meta http-equiv="content-type" content="text/html;charset=utf-8" />

<head>
    <script src="{% static 'dash/assets/script/darkmode.js' %}"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <title>Realestate Dashboard</title>
    <link rel="icon" type="image/png" href="{% static 'dash/assets/images/icons/nav_img.png' %}">

    <script src="{% static 'dash/assets/script/unpkg.com/lucide%400.562.0/dist/umd/lucide.js' %}"></script>
    <script src="{% static 'dash/assets/script/cdn.jsdelivr.net/npm/chart.js' %}"></script>
    <script src="https://unpkg.com/lucide@latest"></script>


    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;display=swap"
        rel="stylesheet">

    <link href="{% static 'dash/assets/css/index.css' %}" rel="stylesheet">
</head>

<body class="bg-bg">
    <aside class="sidebar fixed left-0 top-0 bottom-0 w-72 overflow-y-auto" id="sidebar">
        <div class="p-6">
            <div class="flex justify-between items-center gap-3 mb-8">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 relative overflow-hidden"><img
                            src="{% static 'dash/assets/images/icons/nav_img.png' %}" alt="pageLogo"
                            class="h-full w-full object-cover" /></div>
                    <div class="flex flex-col"><a href="#"
                            class="text-xl font-bold text-text no-underline">Realestate</a>
                        <p class="text-xs text-muted">Dashboard</p>
                    </div>
                </div>
                <div class="customXl:hidden"><button id="sidebarClose"><i data-lucide="x"></i></button></div>
            </div>
            <nav>
                <ul>

                    <!-- MAIN -->
                    <li class="nav-group-title">MAIN</li>

                    <!-- dashboards -->

                    <!-- <li>
                        {% if request.user.is_staff %}
                        <a href="{% url 'admin_dashboard' %}" class="nav-item active">
                            {% elif request.user.role == "agent" %}
                            <a href="{% url 'agent_dashboard' %}" class="nav-item active">
                                {% elif request.user.role == "associate" %}
                                <a href="{% url 'associate_dashboard' %}" class="nav-item active">
                                    {% endif %}
                                    <i data-lucide="layout-dashboard"></i>
                                    <span>Dashboard</span>
                                </a>
                    </li> -->

                    <!--permisisons dashbaords -->

                    {% if request.user.is_superuser or perms.accounts.view_dashboard %}
                    <li>
                        <a href="{% if request.user.is_superuser %}
                        {% url 'admin_dashboard' %}
                        {% elif request.user.role == 'agent' %}
                        {% url 'agent_dashboard' %}
                        {% elif request.user.role == 'associate' %}
                        {% url 'associate_dashboard' %}
                        {% endif %}" class="nav-item">
                            <i data-lucide="layout-dashboard"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    {% endif %}






                    <!-- using permisons redirect the agent is create_associate/admin is create_agent pages -->
                    {% if request.user.is_superuser %}
                    <li>
                        <a href="{% url 'admin_create_agent' %}" class="nav-item">
                            <i data-lucide="user-plus"></i>
                            <span>Create Agent</span>
                        </a>
                    </li>

                    {% elif perms.accounts.view_create_associate %}
                    <li>
                        <a href="{% url 'agent_create_ass' %}" class="nav-item">
                            <i data-lucide="user-plus"></i>
                            <span>Create Associate</span>
                        </a>
                    </li>
                    {% endif %}




                    <!-- admin produts -->
                    {% if request.user.is_superuser or perms.products.view_property %}
                    <li>
                        <a href="{% url 'property_list' %}" class="nav-item">
                            <i data-lucide="building"></i>
                            <span>Products</span>
                        </a>
                    </li>
                    {% endif %}


                    {% if request.user.is_superuser or perms.leads.view_contacts %}
                    <li>
                        <a href="{% url 'contacts' %}" class="nav-item">
                            <i data-lucide="contact"></i>
                            <span>Contacts</span>
                        </a>
                    </li>
                    {% endif %}


                    <!-- FINANCE -->
                    <li class="nav-group-title">FINANCE</li>

                    <li>
                        <a href="#" class="nav-item">
                            <i data-lucide="wallet"></i>
                            <span>Wallets</span>
                        </a>
                    </li>

                    <li>
                        <a href="#" class="nav-item">
                            <i data-lucide="calendar-check"></i>
                            <span>Tasks</span>
                        </a>
                    </li>

                    <!-- <li>
                        <a href="#" class="nav-item">
                            <i data-lucide="arrow-right-left"></i>
                            <span>Payments</span>
                        </a>
                    </li>

                    <li>
                        <a href="#" class="nav-item">
                            <i data-lucide="link"></i>
                            <span>Payment Links</span>
                        </a>
                    </li> -->

                    <!-- CUSTOMERS -->
                    <li class="nav-group-title">CUSTOMERS</li>

                    <!-- <li>
                        {% if request.user.is_staff %}
                        <a href="{% url 'admin_leads' %}" class="nav-item">
                            {% elif request.user.role == "agent" %}
                            <a href="{% url 'agent_leads' %}" class="nav-item">
                                {% elif request.user.role == "associate" %}
                                <a href="{% url 'associate_leads' %}" class="nav-item">
                                    {% endif %}
                                    <i data-lucide="network"></i>
                                    <span>Leads</span>
                                </a>
                    </li> -->

                    {% if request.user.is_superuser or perms.leads.view_leads %}
                    <li>
                        <a href="{% if request.user.is_superuser %}
                        {% url 'admin_leads' %}
                        {% elif request.user.role == 'agent' %}
                        {% url 'agent_leads' %}
                        {% elif request.user.role == 'associate' %}
                        {% url 'associate_leads' %}
                        {% endif %}" class="nav-item">
                            <i data-lucide="trending-up"></i>
                            <span>Leads</span>
                        </a>
                    </li>
                    {% endif %}



                    <li>
                        {% if request.user.is_staff %}
                        <a href="{% url 'manage_permissions' user.id %}" class="nav-item">
                            {% elif request.user.role == "agent" %}
                            <a href="#" class="nav-item">
                                {% elif request.user.role == "associate" %}
                                <a href="#" class="nav-item">

                                    {% endif %}
                                    <i data-lucide="user-cog"></i>
                                    <span> Permissions</span>
                                </a>
                    </li>

                    <!-- ACCOUNT RECEIVABLES -->
                    <!-- <li class="nav-group-title">ACCOUNT RECEIVABLES</li>   -->

                    <!-- <li>
                        <a href="#" class="nav-item">
                            <i data-lucide="file-text"></i>
                            <span>Invoices</span>
                        </a>
                    </li>  -->

                    <!-- <li>
                        <a href="#" class="nav-item">
                            <i data-lucide="package"></i>
                            <span>Products</span>
                        </a>
                    </li> -->

                    <!-- <li>
                        <a href="#" class="nav-item">
                            <i data-lucide="receipt"></i>
                            <span>Billings</span>
                        </a>
                    </li> -->

                    <!-- OTHERS -->
                    <!-- <li class="nav-group-title">OTHERS</li>

                    <li>
                       <a href="#" class="nav-item">
                            <i data-lucide="globe"></i>
                            <span>Connections</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-item">
                            <i data-lucide="users-2"></i>
                            <span>People</span>
                        </a>
                    </li> 

                    <li>
                        <a href="#" class="nav-item">
                            <i data-lucide="settings"></i>
                            <span>Settings</span>
                        </a>
                    </li> -->

                </ul>
            </nav>


        </div>
    </aside>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <main class="main-content">

        <header class="header">
            <div class="xl:py-4">
                <div class="flex items-center justify-between gap-4 flex-nowrap w-full">
                    <div class="flex items-center gap-3 shrink-0">
                        <button class="btn-icon customXl:hidden! opacity-100! flex! pointer-events-auto!"
                            id="mobile-menu-toggle">
                            <i data-lucide="menu" class="w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6"></i>
                        </button>

                        <div class="hidden sm:flex flex-col leading-tight">
                            <h2 class="text-lg sm:text-xl md:text-2xl font-bold truncate max-w-[200px] capitalize">
                                {{ page_title|default:"Dashboard" }}
                            </h2>
                            <p class="text-xs sm:text-sm text-muted truncate max-w-[120px] sm:max-w-40]">
                                Online Booking
                            </p>
                        </div>
                    </div>

                    <!-- RIGHT SIDE (UNCHANGED) -->
                    <div class="flex items-center gap-3 flex-nowrap ml-auto">
                        <div class="relative hidden md:block">
                            <div class="absolute left-3 top-3.5 text-gray-400">
                            </div>
                        </div>
                        <div class="relative"><input type="checkbox" id="notif-toggle" class="hidden peer" />
                            <label for="notif-toggle" class="btn-icon relative shrink-0 hover:text-rose-500"
                                id="notifications-btn">

                                <img src="{% static 'dash/assets/images/icons/notification.png' %}" alt="Notifications"
                                    class="notif-icon" style="width:30px;height:30px;">

                                <span
                                    class="absolute -top-1 -right-1 w-5 h-5 bg-danger text-white text-xs rounded-full d-flex align-items-center justify-content-center">
                                    3
                                </span>
                            </label>

                            <div
                                class="fixed sm:absolute left-4 right-4 sm:left-auto sm:right-0 mt-2 sm:w-80 bg-panel rounded-lg shadow-lg border border-border opacity-0 invisible peer-checked:opacity-100 peer-checked:visible transition-all duration-200 z-50">
                                <div class="p-3 sm:p-4 border-b border-border">
                                    <h3 class="text-base sm:text-lg font-semibold text-muted">Notifications</h3>
                                </div>
                                <ul class="max-h-72 sm:max-h-96 overflow-y-auto">
                                    <li
                                        class="p-3 sm:p-4 hover:bg-gray-50 border-b border-border flex items-start space-x-3 group">
                                        <div class="w-2 h-2 bg-blue-500 rounded-full mt-2 shrink-0"></div>
                                        <div class="min-w-0">
                                            <p class="text-sm font-medium text-text group-hover:text-muted truncate">New
                                                payment received</p>
                                            <p class="text-xs text-muted truncate">+$1,250 from Acme Corp</p>
                                            <p class="text-xs text-gray-400 mt-1">2 minutes ago</p>
                                        </div>
                                    </li>
                                    <li
                                        class="p-3 sm:p-4 hover:bg-gray-50 border-b border-border flex items-start space-x-3 group">
                                        <div class="w-2 h-2 bg-green-500 rounded-full mt-2 shrink-0"></div>
                                        <div class="min-w-0">
                                            <p class="text-sm font-medium text-text group-hover:text-muted truncate">
                                                Invoice #1234 paid</p>
                                            <p class="text-xs text-muted truncate">Client: Jane Doe</p>
                                            <p class="text-xs text-gray-400 mt-1">1 hour ago</p>
                                        </div>
                                    </li>
                                    <li
                                        class="p-3 sm:p-4 hover:bg-gray-50 flex items-start space-x-3 group border-b border-border">
                                        <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2 shrink-0"></div>
                                        <div class="min-w-0">
                                            <p class="text-sm font-medium text-text group-hover:text-muted truncate">Low
                                                balance alert</p>
                                            <p class="text-xs text-muted truncate">Account balance is below $500</p>
                                            <p class="text-xs text-gray-400 mt-1">3 hours ago</p>
                                        </div>
                                    </li>
                                </ul>
                                <div class="p-3 text-center"><a href="#"
                                        class="text-sm text-blue-600 hover:underline">View all notifications</a></div>
                            </div>
                        </div>
                        <button class="btn-icon shrink-0" id="theme-toggle"></button>
                        <div class="relative">
                            <!-- toggle checkbox -->
                            <input type="checkbox" id="profile-toggle" class="hidden peer" />

                            <!-- profile button -->
                            <label for="profile-toggle"
                                class="flex items-center gap-2 rounded-xl sm:rounded-2xl bg-panel border border-border hover:border-primary transition-all"
                                id="user-menu-btn">

                                <span class="profile-icon rounded-lg sm:rounded-xl overflow-hidden w-10 h-10">
                                    {% if request.user.profile_image %}
                                    <img src="{{ request.user.profile_image.url }}?v={{ request.user.id }}"
                                        alt="Profile" class="w-full h-full object-cover">
                                    {% else %}
                                    <img src="{% static 'dash/assets/images/icons/user_img.png' %}"
                                        alt="Default Profile" class="w-full h-full object-cover">
                                    {% endif %}
                                </span>
                            </label>

                            <!-- dropdown -->
                            <div class="absolute right-0 mt-2 w-56 bg-bg rounded-lg shadow-lg border border-border
                opacity-0 invisible peer-checked:opacity-100 peer-checked:visible
                transition-all duration-200 z-50">

                                <!-- user info -->
                                <div class="p-4 border-b border-border">
                                    <p class="font-medium text-text">{{ request.user.username }}</p>
                                    <p class="text-sm text-muted">{{ request.user.email }}</p>

                                    <p class="font-semibold capitalize text-text">Role: {{ request.user.role }}</p>
                                </div>

                                <ul class="py-2">

                                    <!-- change image -->
                                    {% if request.user.is_superuser %}
                                    <li class="px-4 py-2">
                                        <form method="post" action="{% url 'change_superuser_image' %}"
                                            enctype="multipart/form-data">
                                            {% csrf_token %}

                                            <!-- hidden input -->
                                            <input type="file" id="profile-image-input" name="profile_image"
                                                accept="image/*" class="hidden" onchange="this.form.submit()">

                                            <!-- trigger -->
                                            <label for="profile-image-input"
                                                class="block text-sm text-primary cursor-pointer hover:underline">
                                                Change image
                                            </label>
                                        </form>
                                    </li>
                                    <li>
                                        <hr class="my-1 border-border">
                                    </li>
                                    {% endif %}

                                    <!-- settings -->
                                    <li>
                                        <a href="setting.html"
                                            class="block px-4 py-2 text-sm text-muted hover:bg-panel">
                                            Settings
                                        </a>
                                    </li>

                                    <!-- billing -->
                                    <li>
                                        <a href="billings.html"
                                            class="block px-4 py-2 text-sm text-muted hover:bg-panel">
                                            Billing
                                        </a>
                                    </li>

                                    <li>
                                        <hr class="my-1 border-border">
                                    </li>

                                    <!-- logout -->
                                    <li>
                                        <a href="{% url 'logout' %}"
                                            class="block px-4 py-2 text-sm text-muted hover:bg-panel">
                                            Sign out
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>


        <section class="p-6">
            {% block content %}{% endblock %}
        </section>

    </main>
    <script
        src="{% static 'dash/assets/script/cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js' %}"></script>
    <script src="{% static 'dash/assets/script/cdn.jsdelivr.net/npm/xlsx%400.18.5/dist/xlsx.full.min.js' %}"></script>
    <script defer="defer" src="{% static 'dash/assets/script/app.js' %}"></script>
</body>

</html>